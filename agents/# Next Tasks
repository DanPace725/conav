# Next Tasks — Relational CoNav v0.2 (DB + Life Context)

This document defines the next implementation steps for adding:
- a minimal persistence layer (Supabase + relational DB)
- a lightweight “life context” cache
- evaluation storage and retrieval

The goal is to **keep complexity bounded**, **avoid framework bloat**, and **preserve the current simplicity** of the HTML/JS app.

---

## Phase 0 — Repo + Environment Prep

- [ ] Confirm current app structure:
  - `index.html`
  - `script.js`
  - `styles.css`
  - `coherence_profile.json`
  - `agents/`
- [ ] Add a new `docs/` folder (if not present) and place this file there (or link it from root).
- [ ] Ensure `.env` or similar mechanism is available for API keys (OpenAI + Supabase).

**Acceptance criteria:**
- Repo is clean, current app still runs as-is.
- A place for secrets/config is clearly defined (even if only documented for now).

---

## Phase 1 — Supabase Setup (Auth + DB)

> NOTE: Keep schema minimal. No extra tables beyond what is needed.

### 1.1 Supabase Project

- [ ] Create a Supabase project (dev or test is fine).
- [ ] Enable email/password auth (or anonymous if preferred for now).
- [ ] Add project URL and anon key to a local config (do not hardcode into `script.js`).

### 1.2 Database Schema

Create 3 tables:

#### `users`

- [ ] Table: `users`
  - `id` `uuid` primary key (Supabase `auth.users` id or standalone if easier)
  - `email` `text` (optional for now)
  - `created_at` `timestamp` default `now()`

#### `life_contexts`

- [ ] Table: `life_contexts`
  - `id` `uuid` primary key
  - `user_id` `uuid` references `users(id)` (or `auth.users.id` if using Supabase auth directly)
  - `domains` `jsonb` (e.g. `["work","kids","school"]`)
  - `roles` `jsonb` (e.g. `["parent","student","partner"]`)
  - `constraints` `jsonb` (e.g. `{ "time": "low", "energy": "medium" }`)
  - `updated_at` `timestamp` default `now()`

#### `evaluations`

- [ ] Table: `evaluations`
  - `id` `uuid` primary key
  - `user_id` `uuid` references `users(id)`
  - `input_text` `text`
  - `scores` `jsonb`  
    (e.g. `{ "continuity": 0.4, "differentiation": 0.6, ... }`)
  - `composite` `float8`
  - `notes` `jsonb`  
    (dimension-specific explanations, if needed)
  - `summary` `text`
  - `recommendations` `jsonb`
  - `context_used` `jsonb`  
    (subset of `life_contexts` used in this evaluation, optional)
  - `created_at` `timestamp` default `now()`

**Acceptance criteria:**
- All tables created successfully.
- Foreign keys wired correctly (on either local `users` or `auth.users`).
- Schema documented in `docs/db_schema.md` (can be generated by agents).

---

## Phase 2 — Supabase Client Integration (Minimal)

> Keep logic **flat and simple** inside `script.js` or a tiny helper file (e.g. `supabase.js`).

### 2.1 Add Supabase JS Client

- [ ] Include Supabase client via CDN in `index.html` **or** via a small module file.
  - Example CDN: `https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js`

### 2.2 Initialize Client

- [ ] Add a small Supabase init section in `script.js` (or `supabase.js`):

  ```js
  const SUPABASE_URL = "YOUR_SUPABASE_URL";
  const SUPABASE_ANON_KEY = "YOUR_SUPABASE_ANON_KEY";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
